# Task 4: Hypothesize and Test Workarounds for Dynamic Route CSS Bundling

**Goal:** Test potential workarounds for the suspected Astro/Vite bug (#3816) causing missing CSS links on dynamic pages generated by `[urlPath].astro`.

**Context:** Research suggests the issue lies in CSS dependency analysis or chunking for dynamic routes using glob imports (like content collections).

**Hypothesis:** Astro/Vite's CSS chunking for dynamic routes is failing to include necessary styles, possibly due to how styles within the `<Content />` component are analyzed or how shared CSS chunks are determined.

**Test 1: Disable CSS Code Splitting**

1.  **Modify `astro.config.mjs`:** Add Vite build options to disable CSS code splitting.
    ```javascript
    // astro.config.mjs
    import { defineConfig } from "astro/config";
    import react from "@astrojs/react";
    import tailwind from "@astrojs/tailwind";

    export default defineConfig({
      integrations: [react(), tailwind({ applyBaseStyles: false })], // Keep applyBaseStyles: false
      vite: {
        build: {
          cssCodeSplit: false, // Add this line
        },
      },
    });
    ```
2.  **Ensure Baseline:** Verify `globals.css` is imported directly in `[urlPath].astro` and `index.astro`.
3.  **Clear Cache & Build:** Stop server, run `rm -rf .astro dist`, run `npx astro build`.
4.  **Preview & Verify:** Run `npx astro preview` and check if styling works on a dynamic page (e.g., `/websites/github_com_pluja_awesome_privacy`).
5.  **Document Result in `task.md`:** Overwrite this file with the outcome of Test 1. If it worked, the task is complete. If not, proceed to Test 2.

**Test 2: Explicitly Import Key Component (Only if Test 1 Fails)**

1.  **Revert `astro.config.mjs`:** Remove the `vite: { build: { cssCodeSplit: false } }` configuration.
2.  **Modify `[urlPath].astro`:** Import a component with significant styling (e.g., `Navbar`) and include it in the template (it can be commented out HTML-style `<!-- <Navbar /> -->` if needed, just the import and usage might be enough for analysis).
    ```astro
    ---
    import Layout from '../../layouts/Layout.astro';
    import { getCollection } from 'astro:content';
    import "../../styles/globals.css";
    import Navbar from '../../components/Navbar'; // Import a styled component

    // ... rest of frontmatter ...
    const { Content } = await entry.render();
    ---
    <Layout title={entry.data.title || 'Website Details'}>
      {/* <Navbar /> */} <!-- Include the component, even if commented out -->
      <main class="container mx-auto px-4 md:px-0 py-8">
        {/* ... rest of template ... */}
      </main>
    </Layout>
    ```
3.  **Clear Cache & Build:** Stop server, run `rm -rf .astro dist`, run `npx astro build`.
4.  **Preview & Verify:** Run `npx astro preview` and check styling on a dynamic page.
5.  **Document Result in `task.md`:** Overwrite this file with the outcome of Test 2.